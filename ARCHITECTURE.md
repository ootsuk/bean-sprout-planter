# è±†è‹—ãƒ—ãƒ©ãƒ³ã‚¿ãƒ¼ - ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£èª¬æ˜æ›¸

## ğŸ“‹ æ¦‚è¦
ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€è±†è‹—æ ½åŸ¹ã«ç‰¹åŒ–ã—ãŸè‡ªå‹•æ¤ç‰©è‚²æˆã‚·ã‚¹ãƒ†ãƒ ã®å„ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²ã€é€£æºæ–¹æ³•ã€ä¸»è¦ãªé–¢æ•°ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

---

## ğŸ—ï¸ å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ï¼‰                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“ HTTP
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  main.py                                        â”‚
â”‚  - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ          â”‚
â”‚  - ã‚µãƒ¼ãƒãƒ¼èµ·å‹•                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  src/app/app.py                                 â”‚
â”‚  - Flaskã‚¢ãƒ—ãƒªä½œæˆ                              â”‚
â”‚  - ç”»é¢è¡¨ç¤ºãƒ«ãƒ¼ãƒˆå®šç¾©ï¼ˆHTMLè¿”ã™ï¼‰               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”»é¢è¡¨ç¤º     â”‚      â”‚ API (JSONè¿”ã™)    â”‚
â”‚ templates/   â”‚      â”‚ src/api/         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                     â†“                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã‚»ãƒ³ã‚µãƒ¼     â”‚      â”‚ ã‚«ãƒ¡ãƒ©       â”‚      â”‚ çµ¦æ°´åˆ¶å¾¡     â”‚
â”‚ src/sensors/ â”‚      â”‚ src/camera/  â”‚      â”‚ src/watering/â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ AIåˆ¤æ–­æ©Ÿèƒ½       â”‚
                    â”‚ src/ai/         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«åˆ¥ã®å½¹å‰²ã¨é€£æº

### ğŸ”¹ **1. main.py**ï¼ˆã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼‰

**å½¹å‰²:**
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•
- ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–
- Flaskã‚¢ãƒ—ãƒªã®ä½œæˆã¨å®Ÿè¡Œ

**ä¸»è¦ãªé–¢æ•°:**
```python
def main():
    """ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œé–¢æ•°"""
    # 1. ãƒ­ã‚°è¨­å®š
    setup_logging()  # src/utils/logger.py ã‹ã‚‰
    
    # 2. Flaskã‚¢ãƒ—ãƒªä½œæˆ
    app = create_app()  # src/app/app.py ã‹ã‚‰
    
    # 3. APIãƒ–ãƒ«ãƒ¼ãƒ—ãƒªãƒ³ãƒˆç™»éŒ²
    register_api_blueprints(app)  # src/api/api_blueprint.py ã‹ã‚‰
    
    # 4. ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
    app.run(host='0.0.0.0', port=8080)
```

**é€£æºå…ˆ:**
- `src/app/app.py` - Flaskã‚¢ãƒ—ãƒªä½œæˆ
- `src/api/api_blueprint.py` - APIç™»éŒ²
- `src/utils/logger.py` - ãƒ­ã‚°è¨­å®š

---

### ğŸ”¹ **2. src/app/app.py**ï¼ˆFlaskã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰

**å½¹å‰²:**
- Flaskã‚¢ãƒ—ãƒªã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
- ç”»é¢è¡¨ç¤ºãƒ«ãƒ¼ãƒˆã®å®šç¾©ã®ã¿ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ï¼‰
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**ä¸»è¦ãªé–¢æ•°:**
```python
def create_app():
    """Flaskã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ"""
    app = Flask(__name__)
    
    # ãƒ«ãƒ¼ãƒˆå®šç¾©ï¼ˆç”»é¢è¡¨ç¤ºã®ã¿ï¼‰
    @app.route('/')
    def index():
        return render_template('index.html')
    
    @app.route('/dashboard')
    def dashboard():
        return render_template('dashboard.html')
    
    @app.route('/settings')
    def settings():
        return render_template('settings.html')
    
    @app.route('/ai-consultation')
    def ai_consultation():
        return render_template('ai_consultation.html')
    
    return app
```

**é€£æºå…ˆ:**
- `src/web/templates/` - HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
- `src/web/static/` - CSS/JavaScript

**é‡è¦:** APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯å®šç¾©ã—ãªã„ï¼ˆsrc/api/ã«åˆ†é›¢ï¼‰

---

### ğŸ”¹ **3. src/api/api_blueprint.py**ï¼ˆAPIçµ±åˆç®¡ç†ï¼‰

**å½¹å‰²:**
- å…¨ã¦ã®APIãƒ–ãƒ«ãƒ¼ãƒ—ãƒªãƒ³ãƒˆã‚’çµ±åˆ
- Flaskã‚¢ãƒ—ãƒªã«ä¸€æ‹¬ç™»éŒ²

**ä¸»è¦ãªé–¢æ•°:**
```python
def register_api_blueprints(app: Flask):
    """APIãƒ–ãƒ«ãƒ¼ãƒ—ãƒªãƒ³ãƒˆã‚’Flaskã‚¢ãƒ—ãƒªã«ç™»éŒ²"""
    
    # å„APIã‚’ç™»éŒ²
    app.register_blueprint(sensors_bp)      # ã‚»ãƒ³ã‚µãƒ¼API
    app.register_blueprint(watering_bp)     # çµ¦æ°´API
    app.register_blueprint(camera_bp)       # ã‚«ãƒ¡ãƒ©API
    app.register_blueprint(notifications_bp) # é€šçŸ¥API
    app.register_blueprint(settings_bp)     # è¨­å®šAPI
    app.register_blueprint(ai_bp)           # AIç›¸è«‡APIï¼ˆæ–°è¦ï¼‰
```

**é€£æºå…ˆ:**
- `src/api/sensors_api.py`
- `src/api/watering_api.py`
- `src/api/camera_api.py`
- `src/api/notifications_api.py`
- `src/api/settings_api.py`
- `src/api/ai_api.py`ï¼ˆæ–°è¦ï¼‰

---

### ğŸ”¹ **4. src/ai/ai_consultation.py**ï¼ˆAIåˆ¤æ–­æ©Ÿèƒ½ï¼‰

**å½¹å‰²:**
- ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«AIï¼ˆVisionãƒ¢ãƒ‡ãƒ«ï¼‰APIã¨ã®é€£æº
- ç”»åƒã¨ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’çµ„ã¿åˆã‚ã›ãŸé«˜åº¦ãªçŠ¶æ³åˆ¤æ–­
- åç©«åˆ¤æ–­ã€ç—…æ°—è¨ºæ–­ã€èª¿ç†ä¾‹ãªã©ã‚’æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ï¼ˆJSONï¼‰ã§æä¾›

**ä¸»è¦ãªã‚¯ãƒ©ã‚¹:**
```python
class AIConsultationManager:
    def __init__(self):
        """AIç›¸è«‡ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®åˆæœŸåŒ–"""
        # APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’åˆæœŸåŒ– (OpenAI, Anthropic, Google AI)
        self._initialize_clients()

    def get_harvest_judgment(self, image_path: str, sensor_data: dict):
        """åç©«åˆ¤æ–­ã‚’å®Ÿè¡Œ"""
        # 1. ç”»åƒã‚’ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
        # 2. Visionãƒ¢ãƒ‡ãƒ«ã«ç”»åƒã¨ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡
        # 3. AIã‹ã‚‰ã®JSONå¿œç­”ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦è¿”ã™
        
        return {
            'harvest_ready': True,
            'confidence': 0.95,
            'recommendation': 'è‘‰ã®è‰²ã‚‚æ¿ƒãã€åç©«ã«æœ€é©ãªçŠ¶æ…‹ã§ã™ã€‚',
            'days_remaining': 0
        }
    
    def diagnose_disease(self, image_path: str, symptoms: list):
        """ç—…æ°—è¨ºæ–­ã‚’å®Ÿè¡Œ"""
        # 1. ç”»åƒã‚’ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
        # 2. Visionãƒ¢ãƒ‡ãƒ«ã«ç”»åƒã¨ç—‡çŠ¶ã‚’é€ä¿¡
        # 3. AIã‹ã‚‰ã®JSONå¿œç­”ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦è¿”ã™
        
        return {
            'disease_detected': 'å¥åº·',
            'confidence': 0.98,
            'treatment': 'ç¾åœ¨ã®ã¨ã“ã‚å¯¾å‡¦ã®å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚',
            'prevention': 'å¼•ãç¶šãé€šæ°—æ€§ã‚’ç¢ºä¿ã—ã¦ãã ã•ã„ã€‚'
        }
    
    def get_cooking_suggestions(self, harvest_data: dict):
        """èª¿ç†ä¾‹ã‚’æä¾›"""
        # 1. LLMã«åç©«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡
        # 2. AIã‹ã‚‰ã®JSONå¿œç­”ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦è¿”ã™
        
        return {
            'recommended_dishes': ['è±†è‹—ã¨è±šè‚‰ã®ç‚’ã‚ç‰©', 'è±†è‹—ã®ãƒŠãƒ ãƒ«'],
            'cooking_tips': 'ã‚·ãƒ£ã‚­ã‚·ãƒ£ã‚­æ„Ÿã‚’æ®‹ã™ãŸã‚ã€åŠ ç†±ã¯çŸ­æ™‚é–“ã§ã€‚',
            'nutrition_info': 'ãƒ“ã‚¿ãƒŸãƒ³Kã€ãƒ“ã‚¿ãƒŸãƒ³Aã€è‘‰é…¸ãŒè±Šå¯Œã§ã™ã€‚'
        }
```

**é€£æºå…ˆ:**
- `src/api/ai_api.py` - AIç›¸è«‡API

---

### ğŸ”¹ **5. src/api/ai_api.py**ï¼ˆAIç›¸è«‡APIï¼‰

**å½¹å‰²:**
- AIç›¸è«‡æ©Ÿèƒ½ã®RESTful APIæä¾›
- ã‚«ãƒ¡ãƒ©ã€ã‚»ãƒ³ã‚µãƒ¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨é€£æºã—ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿ã§AIã‚’å‘¼ã³å‡ºã—

**APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:**
```
POST /api/ai/consultation       - ä¸€èˆ¬ç›¸è«‡ï¼ˆç”»åƒä»˜ãå¯¾å¿œï¼‰
POST /api/ai/harvest-judgment   - åç©«åˆ¤æ–­ï¼ˆç”»åƒãƒ»ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿é€£æºï¼‰
POST /api/ai/disease-check      - ç—…æ°—è¨ºæ–­
POST /api/ai/cooking-tips       - èª¿ç†ä¾‹ææ¡ˆ
GET  /api/ai/tags              - ç›¸è«‡ã‚¿ã‚°ä¸€è¦§å–å¾—
GET  /api/ai/history           - ç›¸è«‡å±¥æ­´å–å¾—
```

**ä¸»è¦ãªã‚¯ãƒ©ã‚¹:**
```python
class AIConsultationResource(Resource):
    def post(self):
        """AIç›¸è«‡ã‚’å®Ÿè¡Œ"""
        data = request.get_json()
        question = data.get('question')
        tag = data.get('tag', 'general')
        
        # AIç›¸è«‡ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã«å•ã„åˆã‚ã›
        result = ai_manager.consult(question, tag)
        
        return {
            'status': 'success',
            'answer': result['answer'],
            'confidence': result['confidence'],
            'tag': tag
        }

class HarvestJudgmentResource(Resource):
    def post(self):
        """åç©«åˆ¤æ–­ã‚’å®Ÿè¡Œ"""
        # æœ€æ–°ã®ç”»åƒã¨ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        image_path = camera_manager.get_latest_image()
        sensor_data = sensor_manager.get_latest_data()
        
        # AIåˆ¤æ–­ã‚’å®Ÿè¡Œ
        judgment = ai_manager.get_harvest_judgment(image_path, sensor_data)
        
        return {
            'status': 'success',
            'harvest_ready': judgment['harvest_ready'],
            'confidence': judgment['confidence'],
            'recommendation': judgment['recommendation']
        }
```

**é€£æºå…ˆ:**
- `src/ai/ai_consultation.py` - AIåˆ¤æ–­ãƒ­ã‚¸ãƒƒã‚¯

---

### ğŸ”¹ **6. src/camera/multi_camera_manager.py**ï¼ˆå¤šå±¤åŒ–ã‚«ãƒ¡ãƒ©ç®¡ç†ï¼‰

**å½¹å‰²:**
- è¤‡æ•°ã‚«ãƒ¡ãƒ©ã®ç®¡ç†
- éšå±¤åˆ¥æ’®å½±åˆ¶å¾¡

**ä¸»è¦ãªã‚¯ãƒ©ã‚¹:**
```python
class MultiCameraManager:
    def __init__(self):
        """å¤šå±¤åŒ–ã‚«ãƒ¡ãƒ©ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®åˆæœŸåŒ–"""
        self.cameras = {}
        self.camera_configs = self._load_camera_configs()
    
    def add_camera(self, camera_id: str, camera_index: int, layer: int):
        """ã‚«ãƒ¡ãƒ©ã‚’è¿½åŠ """
        self.cameras[camera_id] = {
            'index': camera_index,
            'layer': layer,
            'enabled': True,
            'last_capture': None
        }
    
    def capture_layer(self, layer: int):
        """æŒ‡å®šéšå±¤ã®æ’®å½±ã‚’å®Ÿè¡Œ"""
        layer_cameras = [cam for cam in self.cameras.values() if cam['layer'] == layer]
        
        results = []
        for camera_id, config in layer_cameras.items():
            if config['enabled']:
                result = self._capture_single_camera(camera_id, config)
                results.append(result)
        
        return results
    
    def schedule_capture(self, schedule_config: dict):
        """æ’®å½±ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¨­å®š"""
        # å„éšå±¤ã®æ’®å½±æ™‚åˆ»ã‚’è¨­å®š
        # cronã‚¸ãƒ§ãƒ–ã¨ã—ã¦ç™»éŒ²
        
        return {
            'status': 'success',
            'schedule_id': 'schedule_001',
            'layers': schedule_config['layers']
        }
```

**é€£æºå…ˆ:**
- `src/api/camera_api.py` - ã‚«ãƒ¡ãƒ©API
- `src/settings/settings_manager.py` - è¨­å®šç®¡ç†

---

### ğŸ”¹ **7. src/watering/water_tank_manager.py**ï¼ˆçµ¦æ°´ã‚¿ãƒ³ã‚¯ç®¡ç†ï¼‰

**å½¹å‰²:**
- çµ¦æ°´ã‚¿ãƒ³ã‚¯æ®‹é‡ã®è¨ˆç®—ã¨ç®¡ç†
- ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã«ã‚ˆã‚‹åˆæœŸè¨­å®š

**ä¸»è¦ãªã‚¯ãƒ©ã‚¹:**
```python
class WaterTankManager:
    def __init__(self):
        """çµ¦æ°´ã‚¿ãƒ³ã‚¯ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®åˆæœŸåŒ–"""
        self.tank_capacity = 2000  # ml
        self.current_volume = 2000  # ml
        self.water_usage_history = []
    
    def set_initial_volume(self, volume: int):
        """åˆæœŸæ°´é‡ã‚’è¨­å®š"""
        self.current_volume = min(volume, self.tank_capacity)
        self._save_tank_status()
    
    def calculate_remaining_volume(self, watering_amount: int):
        """çµ¦æ°´å¾Œã®æ®‹é‡ã‚’è¨ˆç®—"""
        self.current_volume -= watering_amount
        self.current_volume = max(0, self.current_volume)
        
        # ä½¿ç”¨å±¥æ­´ã‚’è¨˜éŒ²
        self.water_usage_history.append({
            'timestamp': datetime.now(),
            'amount': watering_amount,
            'remaining': self.current_volume
        })
        
        self._save_tank_status()
        return self.current_volume
    
    def get_tank_status(self):
        """ã‚¿ãƒ³ã‚¯çŠ¶æ…‹ã‚’å–å¾—"""
        percentage = (self.current_volume / self.tank_capacity) * 100
        
        return {
            'current_volume': self.current_volume,
            'capacity': self.tank_capacity,
            'percentage': percentage,
            'status': 'low' if percentage < 20 else 'normal',
            'last_refill': self._get_last_refill_date()
        }
    
    def refill_tank(self, amount: int):
        """ã‚¿ãƒ³ã‚¯ã«æ°´ã‚’è£œå……"""
        self.current_volume += amount
        self.current_volume = min(self.current_volume, self.tank_capacity)
        self._save_tank_status()
```

**é€£æºå…ˆ:**
- `src/api/watering_api.py` - çµ¦æ°´API
- `src/sensors/float_switch.py` - ãƒ•ãƒ­ãƒ¼ãƒˆã‚¹ã‚¤ãƒƒãƒ

---

## ğŸ”„ **ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ä¾‹**

### **ä¾‹1: AIåç©«åˆ¤æ–­**

```
1. ãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆdashboard.htmlï¼‰
   â†“ åç©«åˆ¤æ–­ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
   
2. main.js
   â””â”€â”€ checkHarvestReadiness()
   â†“ POST /api/ai/harvest-judgment

3. src/api/ai_api.py
   â”œâ”€â”€ HarvestJudgmentResource.post()
   â”‚   â”œâ”€â”€ camera_manager.get_latest_image_path()  <- æœ€æ–°ç”»åƒå–å¾—
   â”‚   â””â”€â”€ sensor_manager.get_all_sensors_data() <- æœ€æ–°ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿å–å¾—
   â””â”€â”€ ai_manager.get_harvest_judgment()
   â†“

4. src/ai/ai_consultation.py
   â”œâ”€â”€ Visionãƒ¢ãƒ‡ãƒ«APIå‘¼ã³å‡ºã—ï¼ˆç”»åƒï¼‹ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼‰
   â””â”€â”€ JSONå¿œç­”ã‚’ãƒ‘ãƒ¼ã‚¹
   â†“

5. ãƒ–ãƒ©ã‚¦ã‚¶ã«çµæœè¡¨ç¤º
   â””â”€â”€ åç©«æ¨å¥¨åº¦ã€ä¿¡é ¼åº¦ã€æ¨å¥¨äº‹é …
```

### **ä¾‹2: å¤šå±¤åŒ–æ’®å½±**

```
1. ãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆsettings.htmlï¼‰
   â†“ æ’®å½±ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®š
   
2. settings.js
   â””â”€â”€ saveCaptureSchedule()
   â†“ POST /api/camera/schedule

3. src/api/camera_api.py
   â”œâ”€â”€ CameraScheduleResource.post()
   â””â”€â”€ multi_camera_manager.schedule_capture()
   â†“

4. src/camera/multi_camera_manager.py
   â”œâ”€â”€ å„éšå±¤ã®æ’®å½±æ™‚åˆ»è¨­å®š
   â”œâ”€â”€ cronã‚¸ãƒ§ãƒ–ç™»éŒ²
   â””â”€â”€ ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ä¿å­˜
   â†“

5. æŒ‡å®šæ™‚åˆ»ã«è‡ªå‹•æ’®å½±å®Ÿè¡Œ
   â””â”€â”€ å„éšå±¤ã®ã‚«ãƒ¡ãƒ©ã§é †æ¬¡æ’®å½±
```

---

## ğŸ“Š **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“ã®ä¾å­˜é–¢ä¿‚**

```
main.py
  â”œâ”€ depends on: src/app/app.py
  â”œâ”€ depends on: src/api/api_blueprint.py
  â””â”€ depends on: src/utils/logger.py

src/api/api_blueprint.py
  â”œâ”€ depends on: src/api/sensors_api.py
  â”œâ”€ depends on: src/api/watering_api.py
  â”œâ”€ depends on: src/api/camera_api.py
  â”œâ”€ depends on: src/api/notifications_api.py
  â”œâ”€ depends on: src/api/settings_api.py
  â””â”€ depends on: src/api/ai_api.py

src/api/ai_api.py
  â”œâ”€ depends on: src/ai/ai_consultation.py
  â”œâ”€ depends on: src/camera/multi_camera_manager.py
  â””â”€ depends on: src/sensors/sensor_manager.py

src/ai/ai_consultation.py
  â””â”€ depends on: Vision Model APIs (External)

src/camera/multi_camera_manager.py
  â””â”€ depends on: src/settings/settings_manager.py

src/watering/water_tank_manager.py
  â””â”€ depends on: src/sensors/float_switch.py
```

---

## ğŸ¯ **é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ**

### **1. ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ†é›¢:**
- **ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤:** app.pyï¼ˆç”»é¢ï¼‰
- **APIå±¤:** src/api/ï¼ˆJSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼‰
- **ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤:** src/sensors/, src/camera/, src/ai/ãªã©
- **ãƒ‡ãƒ¼ã‚¿å±¤:** config/settings.json, CSVãƒ•ã‚¡ã‚¤ãƒ«

### **2. AIæ©Ÿèƒ½çµ±åˆ:**
- LLM APIé€£æºã«ã‚ˆã‚‹è±†è‹—æ ½åŸ¹æ”¯æ´
- ç”»åƒè§£æã¨ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã®çµ„ã¿åˆã‚ã›
- ã‚¿ã‚°åˆ¥ç›¸è«‡æ©Ÿèƒ½ï¼ˆåç©«åˆ¤æ–­ã€ç—…æ°—ã€èª¿ç†ä¾‹ï¼‰

### **3. å¤šå±¤åŒ–å¯¾å¿œ:**
- è¤‡æ•°ã‚«ãƒ¡ãƒ©ã®ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
- éšå±¤åˆ¥æ’®å½±åˆ¶å¾¡
- ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†

### **4. æ‹¡å¼µæ€§:**
- æ–°ã—ã„ã‚»ãƒ³ã‚µãƒ¼è¿½åŠ : BaseSensorã‚’ç¶™æ‰¿
- æ–°ã—ã„APIè¿½åŠ : Blueprintã§ç™»éŒ²
- æ–°ã—ã„ç”»é¢è¿½åŠ : app.pyã«ãƒ«ãƒ¼ãƒˆè¿½åŠ 
- AIæ©Ÿèƒ½æ‹¡å¼µ: æ–°ã—ã„ã‚¿ã‚°ã¨ãƒ­ã‚¸ãƒƒã‚¯è¿½åŠ 

---

**ä½œæˆæ—¥**: 2025å¹´10æœˆ15æ—¥  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0  
**ãƒ–ãƒ©ãƒ³ãƒ**: bean-sprout-planter



