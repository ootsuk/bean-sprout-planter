# 豆苗プランター - Web UI設計書・仕様書

## 📋 目次
1. [Web UI概要](#web-ui概要)
2. [アーキテクチャ設計](#アーキテクチャ設計)
3. [ページ構成](#ページ構成)
4. [UIコンポーネント](#uiコンポーネント)
5. [スタイル設計](#スタイル設計)
6. [JavaScript機能](#javascript機能)
7. [レスポンシブ設計](#レスポンシブ設計)
8. [将来拡張計画](#将来拡張計画)

---

## 🌐 Web UI概要

### プロジェクト名
**豆苗プランター Web UI (Bean Sprout Planter Web Interface)**

### 目的
豆苗栽培システムの管理・監視・操作を行うWebベースのユーザーインターフェース

### 技術スタック
- **フロントエンド**: HTML5, CSS3, JavaScript (ES6+)
- **UIフレームワーク**: Bootstrap 5.1.3
- **アイコン**: Font Awesome 6.0.0
- **バックエンド**: Flask (Python)
- **テンプレートエンジン**: Jinja2

### 主要機能
- リアルタイムセンサーデータ表示
- AI相談機能（チャット形式・写真添付機能付き）
- 収穫判断・病気診断
- カメラ管理・画像表示
- 給水タンク管理
- システム設定
- 温度変化グラフ表示（実装予定）

---

## 🏗️ アーキテクチャ設計

### Web UI構成図

```
┌─────────────────────────────────────────────────────────┐
│                   ユーザー（ブラウザ）                  │
└─────────────────────────────────────────────────────────┘
                           │ HTTP/HTTPS
┌─────────────────────────────────────────────────────────┐
│                 Flask Application                       │
│  ┌─────────────────────────────────────────────────┐   │
│  │              Jinja2 Templates                  │   │
│  │  ┌─────────────┐  ┌─────────────┐              │   │
│  │  │ HTML Pages  │  │ Static Files│              │   │
│  │  └─────────────┘  └─────────────┘              │   │
│  └─────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
                           │
┌─────────────────────────────────────────────────────────┐
│                  Static Assets                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │ CSS Files   │  │ JS Files    │  │ Images      │     │
│  │ - common    │  │ - common    │  │ - icons     │     │
│  │ - dashboard │  │ - dashboard │  │ - photos    │     │
│  │ - ai-consult│  │ - ai-consult│  │ - placeholders│   │
│  └─────────────┘  └─────────────┘  └─────────────┘     │
└─────────────────────────────────────────────────────────┘
```

### ファイル構成

```
src/web/
├── templates/                    # HTMLテンプレート
│   ├── index.html               # ホームページ
│   ├── dashboard.html           # ダッシュボード
│   ├── ai_consultation.html     # AI相談ページ
│   ├── multi_camera.html        # カメラ管理ページ
│   ├── water_tank.html          # 給水タンクページ
│   ├── settings.html            # 設定ページ
│   ├── logs.html                # ログ表示ページ
│   ├── 404.html                 # エラーページ
│   └── 500.html                 # エラーページ
└── static/                      # 静的ファイル
    ├── css/                     # スタイルシート
    │   ├── common.css           # 共通スタイル
    │   ├── dashboard.css        # ダッシュボード専用
    │   └── ai-consultation.css  # AI相談専用
    ├── js/                      # JavaScript
    │   ├── common.js            # 共通機能
    │   ├── dashboard.js         # ダッシュボード機能
    │   └── ai-consultation.js   # AI相談機能
    └── images/                  # 画像ファイル
        └── placeholder.jpg      # プレースホルダー画像
```

---

## 📄 ページ構成

### 1. ホームページ (`/`)

#### 目的
システムの概要紹介とナビゲーション

#### 主要コンポーネント
- **ヒーローセクション**: システム紹介
- **機能紹介カード**: 主要機能の説明
- **ナビゲーションメニュー**: 各ページへのリンク

#### 実装状況
- ✅ 基本レイアウト完成
- ✅ ナビゲーション完成
- ⏳ 機能紹介カード（実装予定）

### 2. ダッシュボード (`/dashboard`)

#### 目的
システム全体の状態を一目で把握

#### 主要コンポーネント
- **センサー状態カード**: 温度、湿度、タンク残量（土壌水分は削除）
- **AI相談エリア**: 簡易チャット機能（画像添付機能付き）
- **収穫判断エリア**: 自動判定結果表示（手動実行ボタンは削除）
- **最新画像表示**: 最新の撮影画像
- **温度変化グラフ**: 一日の温度変化（実装予定）

#### 実装状況
- ✅ センサー状態カード完成
- ✅ AI相談エリア完成
- ⏳ 収穫判断エリア（自動判定結果表示に変更予定）
- ✅ 最新画像表示完成
- ⏳ 温度変化グラフ（実装予定）

### 3. AI相談ページ (`/ai-consultation`)

#### 目的
豆苗栽培に関するAI相談機能

#### 主要コンポーネント
- **チャットインターフェース**: メイン相談エリア（画像添付機能付き）
- **相談カテゴリ**: タグ選択機能
- **クイックアクション**: 収穫判断、病気診断、調理例
- **相談履歴**: 過去の相談記録

#### 実装状況
- ✅ チャットインターフェース完成
- ⏳ 画像添付機能（実装予定）
- ✅ 相談カテゴリ完成
- ✅ クイックアクション完成
- ✅ 相談履歴完成

### 4. カメラ管理ページ (`/multi-camera`)

#### 目的
多層化カメラの管理と撮影制御

#### 主要コンポーネント
- **カメラ一覧**: 登録済みカメラの表示
- **撮影制御**: 手動撮影ボタン
- **スケジュール設定**: 自動撮影スケジュール
- **画像ギャラリー**: 撮影画像の表示

#### 実装状況
- ⏳ 基本レイアウト（実装予定）
- ⏳ カメラ一覧（実装予定）
- ⏳ 撮影制御（実装予定）
- ⏳ スケジュール設定（実装予定）

### 5. 給水タンクページ (`/water-tank`)

#### 目的
給水タンクの状態管理と制御

#### 主要コンポーネント
- **タンク状態表示**: 残量、容量、使用履歴
- **手動給水制御**: 給水ボタン
- **設定変更**: 給水量設定（閾値設定は削除）
- **使用統計**: 給水履歴グラフ

#### 実装状況
- ⏳ 基本レイアウト（実装予定）
- ⏳ タンク状態表示（実装予定）
- ⏳ 手動給水制御（実装予定）
- ⏳ 設定変更（実装予定）

### 6. 設定ページ (`/settings`)

#### 目的
システム全体の設定管理

#### 主要コンポーネント
- **カメラ設定**: 撮影時刻設定（解像度設定は削除）
- **給水設定**: 間隔、給水量設定（閾値設定は削除）
- **通知設定**: LINE通知設定（メール通知は削除）

#### 実装状況
- ✅ 基本レイアウト完成
- ⏳ カメラ設定（解像度設定削除予定）
- ⏳ 給水設定（閾値設定削除予定）
- ⏳ 通知設定（メール通知削除予定）

---

## 🎨 UIコンポーネント

### 1. 共通コンポーネント

#### 1.1 ナビゲーションバー
- **構成**: ブランドロゴ、メニュー項目
- **メニュー項目**: ダッシュボード、AI相談、カメラ管理、給水タンク、設定
- **レスポンシブ**: モバイルではハンバーガーメニュー

#### 1.2 ステータスカード
- **用途**: センサーデータ表示
- **構成**: アイコン、タイトル、値、単位
- **アニメーション**: ホバー時の浮き上がり効果

#### 1.3 通知システム
- **種類**: 成功、情報、警告、エラー
- **表示位置**: 画面右上固定
- **自動削除**: 3秒後に自動非表示

### 2. ダッシュボード専用コンポーネント

#### 2.1 センサー値表示
- **表示項目**: 温度、湿度、タンク残量
- **更新頻度**: 5秒間隔
- **フォーマット**: 大きな数値表示、単位付き

#### 2.2 収穫判断エリア
- **表示内容**: 自動判定結果のみ
- **更新頻度**: 1時間ごと
- **表示項目**: 収穫可能/不可、信頼度、推奨事項

### 3. AI相談専用コンポーネント

#### 3.1 チャットインターフェース
- **機能**: テキスト入力、画像添付
- **表示**: ユーザー/AIメッセージの区別
- **履歴**: ローカルストレージに保存

#### 3.2 タグ選択システム
- **タグ種類**: 一般相談、収穫判断、病気診断、調理例、水やり、光量、温度管理、栄養管理
- **選択方式**: クリック選択、複数選択可能

#### 3.3 クイックアクション
- **アクション**: 収穫判断、病気診断、調理例
- **実行方式**: ワンクリック実行

---

## 🎨 スタイル設計

### 1. カラーパレット

#### 1.1 メインカラー
- **プライマリ**: #28a745（緑色・豆苗の色）
- **セカンダリ**: #20c997（ティール色）
- **成功**: #28a745（正常動作、収穫可能）
- **情報**: #17a2b8（情報表示、AI相談）
- **警告**: #ffc107（注意事項、設定変更）
- **危険**: #dc3545（エラー、緊急停止）

#### 1.2 セマンティックカラー
- **成功**: 緑色系 - 正常動作、収穫可能
- **情報**: 青色系 - 情報表示、AI相談
- **警告**: 黄色系 - 注意事項、設定変更
- **危険**: 赤色系 - エラー、緊急停止

### 2. タイポグラフィ

#### 2.1 フォント階層
- **H1**: 2.5rem, 700 weight
- **H2**: 2rem, 600 weight
- **H3**: 1.75rem, 600 weight
- **H4**: 1.5rem, 500 weight
- **H5**: 1.25rem, 500 weight
- **H6**: 1rem, 500 weight

#### 2.2 センサー値表示
- **値**: 2.5rem, bold
- **単位**: 0.9rem, 80% opacity

### 3. レイアウトシステム

#### 3.1 グリッドシステム
- **フレームワーク**: Bootstrap 5.1.3の12カラムグリッド
- **ブレークポイント**: xs, sm, md, lg, xl, xxl

#### 3.2 カードレイアウト
- **影**: 0 4px 6px rgba(0,0,0,0.1)
- **ホバー効果**: translateY(-5px)
- **トランジション**: 0.3s

### 4. アニメーション

#### 4.1 ホバーエフェクト
- **カード**: translateY(-2px)
- **ボタン**: translateY(-1px)

#### 4.2 フェードインアニメーション
- **時間**: 0.5s ease-out
- **効果**: opacity 0→1, translateY 20px→0

#### 4.3 パルスアニメーション
- **時間**: 2s infinite
- **効果**: scale 1→1.05→1

---

## ⚡ JavaScript機能

### 1. 共通機能

#### 1.1 API通信
- **方法**: Fetch API使用
- **エラーハンドリング**: try-catch文
- **タイムアウト**: 10秒

#### 1.2 通知システム
- **表示時間**: 3秒
- **位置**: 画面右上固定
- **種類**: success, info, warning, danger

#### 1.3 ローカルストレージ管理
- **用途**: 設定保存、履歴保存
- **エラーハンドリング**: try-catch文
- **フォールバック**: デフォルト値返却

### 2. ダッシュボード機能

#### 2.1 ダッシュボードマネージャー
- **更新間隔**: 5秒
- **初期化**: ページ読み込み時
- **自動更新**: バックグラウンド実行

#### 2.2 センサーデータ更新
- **API**: /api/sensors/
- **更新項目**: 温度、湿度、タンク残量
- **エラー処理**: 通知表示

### 3. AI相談機能

#### 3.1 AI相談マネージャー
- **初期化**: ページ読み込み時
- **履歴管理**: ローカルストレージ
- **タグ管理**: 選択状態保持

#### 3.2 チャット機能
- **メッセージ表示**: ユーザー/AI区別
- **ローディング表示**: スピナー表示
- **履歴保存**: 自動保存

---

## 📱 レスポンシブ設計

### 1. ブレークポイント戦略

#### 1.1 デバイス別対応
- **スマートフォン**: < 576px
- **タブレット（縦）**: 576px - 768px
- **タブレット（横）**: 768px - 992px
- **デスクトップ**: ≥ 992px

#### 1.2 ナビゲーション対応
- **デスクトップ**: 横並びメニュー
- **モバイル**: ハンバーガーメニュー
- **タブレット**: 縦並びメニュー

### 2. レイアウト調整

#### 2.1 カードレイアウト
- **デスクトップ**: 3-4列表示
- **タブレット**: 2列表示
- **モバイル**: 1列表示

#### 2.2 チャットインターフェース
- **デスクトップ**: 高さ400px
- **タブレット**: 高さ350px
- **モバイル**: 高さ300px

---

## 🚀 将来拡張計画

### Phase 1: 基本機能強化（実装予定）

#### 1.1 温度変化グラフ
- **ライブラリ**: Chart.js
- **データ期間**: 24時間
- **更新頻度**: 1時間ごと
- **表示項目**: 温度変化曲線

#### 1.2 画像添付機能
- **対応形式**: JPG, PNG, WebP
- **最大サイズ**: 5MB
- **プレビュー**: 画像縮小表示
- **アップロード**: ドラッグ&ドロップ対応

#### 1.3 自動収穫判断
- **実行頻度**: 1時間ごと
- **判定基準**: 画像解析 + センサーデータ
- **結果表示**: ダッシュボードに自動表示
- **通知**: LINE通知連携

### Phase 2: 高度な機能（計画中）

#### 2.1 ダークモード対応
- **切り替え**: トグルボタン
- **保存**: ローカルストレージ
- **適用範囲**: 全ページ

#### 2.2 PWA対応
- **Service Worker**: オフライン対応
- **マニフェスト**: アプリ化
- **プッシュ通知**: ブラウザ通知

#### 2.3 リアルタイム更新
- **WebSocket**: 双方向通信
- **更新項目**: センサーデータ、画像
- **接続管理**: 自動再接続

### Phase 3: モバイルアプリ化（将来）

#### 3.1 ネイティブアプリ機能
- **プッシュ通知**: ネイティブ通知
- **カメラ機能**: 直接撮影
- **オフライン同期**: データ同期
- **バックグラウンド更新**: 定期更新

#### 3.2 クロスプラットフォーム
- **React Native**: iOS/Android対応
- **Flutter**: 高性能UI
- **Ionic**: Web技術活用
- **Capacitor**: ハイブリッドアプリ

---

## 📊 パフォーマンス最適化

### 1. 読み込み最適化

#### 1.1 リソース最適化
- **CSS**: 遅延読み込み
- **JavaScript**: 非同期読み込み
- **画像**: 遅延読み込み

#### 1.2 画像最適化
- **形式**: WebP優先
- **サイズ**: レスポンシブ画像
- **圧縮**: 自動圧縮

### 2. JavaScript最適化

#### 2.1 コード分割
- **動的インポート**: 必要時読み込み
- **バンドル分割**: 機能別分割
- **Tree Shaking**: 未使用コード削除

#### 2.2 メモリ管理
- **イベントリスナー**: 適切な削除
- **オブジェクト**: 参照解除
- **キャッシュ**: 適切な管理

---

## 🔧 開発・テスト

### 1. 開発環境

#### 1.1 ローカル開発
- **サーバー**: Flask開発サーバー
- **ポート**: 8080
- **URL**: http://localhost:8080

#### 1.2 デバッグツール
- **Chrome DevTools**: デバッグ、パフォーマンス分析
- **Lighthouse**: パフォーマンス、アクセシビリティ評価
- **WAVE**: アクセシビリティ評価

### 2. テスト戦略

#### 2.1 単体テスト
- **フレームワーク**: Jest
- **対象**: JavaScript関数
- **カバレッジ**: 80%以上

#### 2.2 E2Eテスト
- **フレームワーク**: Cypress
- **対象**: ユーザー操作
- **シナリオ**: 主要機能

---

## 📋 まとめ

### Web UIの特徴

1. **モダンなデザイン**: Bootstrap 5.1.3によるレスポンシブデザイン
2. **直感的な操作**: アイコンとカラーによる視覚的な情報伝達
3. **リアルタイム更新**: センサーデータの自動更新機能
4. **AI統合**: チャット形式のAI相談機能（画像添付対応）
5. **モバイル対応**: レスポンシブデザインによる全デバイス対応

### 技術的な強み

1. **コンポーネント化**: 再利用可能なUIコンポーネント
2. **モジュラー設計**: 機能別のJavaScriptファイル分割
3. **パフォーマンス最適化**: 遅延読み込み、キャッシュ戦略
4. **アクセシビリティ**: セマンティックHTML、ARIA属性
5. **拡張性**: 新機能追加が容易な設計

### 今後の発展方向

1. **リアルタイム機能**: WebSocketによる双方向通信
2. **データ可視化**: グラフ・チャートによる情報表示
3. **PWA化**: オフライン対応、プッシュ通知
4. **モバイルアプリ**: ネイティブアプリ機能
5. **AI機能強化**: より高度なAI相談機能（画像解析対応）

---

**作成日**: 2025年10月15日  
**バージョン**: 1.0  
**作成者**: 豆苗プランターチーム  
**最終更新**: 2025年10月15日